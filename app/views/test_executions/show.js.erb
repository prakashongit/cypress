
<% if @test_execution && params[:partial] == '/test_executions/results/execution_results_panel' %>
  <% if @test_execution.incomplete? || (@test_execution.sibling_execution && @test_execution.sibling_execution.incomplete?) %>
    <%# wait 2 seconds. then reload the page %>
    setTimeout(function(){
      $('#test_execution_results_panel_wrapper').html("<%= escape_javascript render partial: '/test_executions/results/execution_results_panel', locals: { task: @test_execution.task, test_execution: @test_execution.task.most_recent_execution } %>");
    }, 2000);
  <% else %>
    <%# don't wait. just load the test executions %>
    $('#test_execution_results_panel_wrapper').html("<%= escape_javascript render partial: '/test_executions/results/execution_results_panel', locals: { task: @test_execution.task, test_execution: @test_execution } %>");
    <%# load the status table after test execution is displayed %>
    $('#task_status_display').html("<%= escape_javascript render partial: 'task_status', locals: { task: @task, current_task: true } %>");

    <%# update panel color %>
    $("#results_panel").removeClass("panel-info").addClass("panel-<%= execution_status_class(@test_execution) %>");
    $("#view_execution").removeClass("btn-info").addClass("btn-<%= execution_status_class(@test_execution) %>");

    <%# run some more scripts to properly initialize the
     failing/passing execution page %>
    initializeTestExecutionResults();
  <% end %>
<% elsif params[:partial] == 'execution_download' %>
  <% unless @product_test.state == :ready %>
    setTimeout(function(){
      $('#display_execution_download').html("<%= escape_javascript render partial: 'execution_download', locals: { product_test: @product_test } %>");
    }, 2000);
  <% else %>
    $('#display_execution_download').html("<%= escape_javascript render partial: 'execution_download', locals: { product_test: @product_test } %>");
  <% end %>
<% end %>

<% if flash[:alert] %>
  $('#flash-wrapper').append("<%= escape_javascript render partial: 'alert', locals: { message: flash[:alert] } %>");
<% end %>
